<!DOCTYPE html>
<html lang="en">
<head>
	<!--    MAIN INFO    -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Admin Panel</title>
	
	<!--    MAIN CSS    -->
	<link rel="stylesheet" href="admin.css">

	<!--    FAVICON    -->
	<link rel="apple-touch-icon" sizes="180x180" href="assets/favicons/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="assets/favicons/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="assets/favicons/favicon-16x16.png">
	<link rel="manifest" href="assets/favicons/site.webmanifest">
	<link rel="mask-icon" href="assets/favicons/safari-pinned-tab.svg" color="#352746">
	<link rel="shortcut icon" href="assets/favicons/favicon.ico">
	<meta name="msapplication-TileColor" content="#352746">
	<meta name="msapplication-config" content="assets/favicons/browserconfig.xml">
	<meta name="theme-color" content="#ffaa30">
</head>
<body>


<main class="dashboard">
	<div class="tabs-container">
		<div class="tab active" @click="currentTab = 1">
			<svg width="100%" height="100%" viewBox="0 0 280 60" preserveAspectRatio="none" version="1.1" xmlns="http://www.w3.org/2000/svg" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
				<g transform="matrix(1.86905,0,0,1.82983,-35.4765,-96.5727)">
					<path d="M163.439,60.647C163.439,55.927 160.712,52.777 155.735,52.777L34.39,52.777C28.359,52.777 24.331,55.767 24.331,60.647L24.331,77.697C24.331,82.636 22.991,85.567 18.981,85.567L168.789,85.567C164.239,85.567 163.439,81.801 163.439,77.697L163.439,60.647Z"/>
				</g>
			</svg>

			<input type="radio" name="tabs" id="tab-members" checked />
			<label for="tab-members">Members</label>
		</div>
		<div class="tab" @click="currentTab = 2">
			<svg width="100%" height="100%" viewBox="0 0 280 60" preserveAspectRatio="none" version="1.1" xmlns="http://www.w3.org/2000/svg" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
				<g transform="matrix(1.86905,0,0,1.82983,-35.4765,-96.5727)">
					<path d="M163.439,60.647C163.439,55.927 160.712,52.777 155.735,52.777L34.39,52.777C28.359,52.777 24.331,55.767 24.331,60.647L24.331,77.697C24.331,82.636 22.991,85.567 18.981,85.567L168.789,85.567C164.239,85.567 163.439,81.801 163.439,77.697L163.439,60.647Z"/>
				</g>
			</svg>

			<input type="radio" name="tabs" id="tab-console" />
			<label for="tab-console">Console</label>
		</div>
		<div class="tab" @click="currentTab = 3">
			<svg width="100%" height="100%" viewBox="0 0 280 60" preserveAspectRatio="none" version="1.1" xmlns="http://www.w3.org/2000/svg" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
				<g transform="matrix(1.86905,0,0,1.82983,-35.4765,-96.5727)">
					<path d="M163.439,60.647C163.439,55.927 160.712,52.777 155.735,52.777L34.39,52.777C28.359,52.777 24.331,55.767 24.331,60.647L24.331,77.697C24.331,82.636 22.991,85.567 18.981,85.567L168.789,85.567C164.239,85.567 163.439,81.801 163.439,77.697L163.439,60.647Z"/>
				</g>
			</svg>

			<input type="radio" name="tabs" id="tab-settings" />
			<label for="tab-settings">Settings</label>
		</div>
	</div>
	<div class="content">
		<div class="content__members active">
			<!-- TODO Length manager for .member__info. -->
			<div class="content__members__settings">
				<div class="left">
					<input type="text" name="search" v-model="search" id="search-member" placeholder="username" />
					<label for="search-member" style="display:none;"></label>

					<div class="dropdown" :class="{'active' : showRoleDropdown}" @mouseleave="showRoleDropdown = false">
						<button class="dropdown__button" @click="showRoleDropdown = !showRoleDropdown">
							<span>Role: {{ role | capitalize }}</span>
							<img src="assets/arrow_dropdown.svg" alt="Arrow down" />
						</button>
						<div class="dropdown__content">
							<input type="radio" name="roles" id="role-all" value="all" v-model="role" checked />
							<label for="role-all">all</label>
							<input type="radio" name="roles" id="role-god" value="god" v-model="role" />
							<label for="role-god">god</label>
							<input type="radio" name="roles" id="role-owner" value="owner" v-model="role" />
							<label for="role-owner">owner</label>
							<input type="radio" name="roles" id="role-admin" value="admin" v-model="role" />
							<label for="role-admin">admin</label>
							<input type="radio" name="roles" id="role-developer" value="developer" v-model="role" />
							<label for="role-developer">developer</label>
							<input type="radio" name="roles" id="role-staff" value="staff" v-model="role" />
							<label for="role-staff">staff</label>
							<input type="radio" name="roles" id="role-lifetime" value="lifetime" v-model="role" />
							<label for="role-lifetime">lifetime</label>
							<input type="radio" name="roles" id="role-renewal" value="renewal" v-model="role" />
							<label for="role-renewal">renewal</label>
						</div>
					</div>
				</div>
				<div class="right">
					<span v-if="this.memberCount !== 1">{{ memberCount }} members</span>
					<span v-else>{{ memberCount }} member</span>
					<button @click="addMember"><img src="assets/icon_add.svg" alt="Plus icon" /></button>
					<button id="refresh-members" @click="refreshMembers()"><img src="assets/icon_reload.svg" alt="Reload icon" /></button>
				</div>
			</div>
			<div :class="{'member-view': true, 'active': showMemberView}">
				<button class="back" @click="[memberViewScrollTop(), memberView = {}]">
					<img src="assets/arrow_left.svg" alt="Arrow left" />
				</button>

				<div class="loader" v-if="JSON.stringify(memberView) === '{}'">
					<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
						 width="40px" height="40px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve">
						<path fill="#FFF" d="M43.935,25.145c0-10.318-8.364-18.683-18.683-18.683c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615c8.072,0,14.615,6.543,14.615,14.615H43.935z">
						  <animateTransform attributeType="xml"
											attributeName="transform"
											type="rotate"
											from="0 25 25"
											to="360 25 25"
											dur="0.6s"
											repeatCount="indefinite"/>
						</path>
					</svg>
				</div>
				<div class="container" v-else>
					<div class="container__welcome">
						<img class="avatar"
							 :src="memberView['avatar_url'] || 'https://cdn.discordapp.com/embed/avatars/1.png?size=2048'"
							 alt="Discord icon" />
						<h2>{{ memberView.username || "Not found" }}</h2>
					</div>
					<div class="container__section">
						<h3>Basic info</h3>
						<div>
							<h6>Role</h6>
							<button class="role" :style="'background-color:' + (memberView.role && memberView.role.color ? memberView.role.color : '#222222')">
								{{ memberView.role && memberView.role.name ? memberView.role.name : "null" }}
							</button>
						</div>
						<div><h6>User id</h6><span>{{ memberView["user_id"] || "undefined" }}</span></div>
						<div><h6>Email</h6><span>{{ memberView.email || "undefined" }}</span></div>
						<div><h6>User since</h6><span>{{ memberView.date_created || "undefined" }}</span></div>
						<div><h6>User in server</h6><span>{{ memberView["user_in_server"] || false }}</span></div>
						<div><h6>Cookie id</h6><span>{{ memberView["cookie_id"] || "undefined" }}</span></div>
					</div>
					<div class="container__section">
						<h3>Stripe info</h3>
						<div><h6>Customer id</h6><span>{{ memberView["stripe_id"] || "undefined" }}</span></div>
						<div><h6>Subscription id</h6><span>{{ memberView["sub_id"] || "undefined" }}</span></div>
						<div><h6>Subscription status</h6><span>{{ memberView["sub_status"] || "undefined" }}</span></div>
						<div><h6>Has default payment</h6><span>{{ memberView["default_payment"] || "undefined" }}</span></div>
					</div>
					<div class="container__section">
						<h3>Last payment</h3>
						<div><h6>Id</h6><span>{{ memberView["invoice_id"] || "undefined" }}</span></div>
						<div><h6>Status</h6><span>{{ memberView["invoice_status"] || "undefined" }}</span></div>
						<div><h6>Date</h6><span>{{ memberView["invoice_date"] || "undefined" }}</span></div>
					</div>
					<div class="container__section">
						<button class="button" @click="deleteMember(memberView['user_id'])">Delete Member</button>
					</div>
				</div>
			</div>

			<div class="member" v-for="member in this.filteredMemberList">
				<div class="member__info">
					<img :src="member.avatar_url" alt="Discord icon" />
					<span>{{ member.username }}</span>
					<button class="tag" :style="'background-color:' + member.role.color">{{ member.role.name }}</button>
				</div>
				<div class="member__links">
					<button class="button view-member" @click="viewMember(member['user_id'])">View</button>
					<button class="button disabled">Edit</button>
				</div>
			</div>

		</div>
		<div class="content__console">
			<div v-for="log in this.filteredLogs">
				{{ log.time }}
				<div :style="'color:' + log.color">
					<b>{{ log.text[0] }}</b>
					<span v-html="log.text.slice(1).join(' ')"></span>
				</div>
			</div>
		</div>
		<div class="content__settings">
			<h2>Web config</h2>
			<div>
				<!-- TODO transform text to lowercase and replace '_' with ' '. -->
				<label for="setting-in_stock">in stock</label>
				<input id="setting-in_stock" type="text" placeholder="in stock" v-model="settings['IN_STOCK']" />
				<button class="button" @click="updateSetting('IN_STOCK')">Update</button>
			</div>
			<div>
				<label for="setting-cookie_key">cookie key</label>
				<input id="setting-cookie_key" type="text" placeholder="cookie key" :value="settings['COOKIE_KEY']" />
				<button class="button" @click="updateSetting('COOKIE_KEY')">Update</button>
			</div>

			<h2>Stripe config</h2>
			<div>
				<label for="setting-stripe_key">public key</label>
				<input id="setting-stripe_key" type="text" placeholder="public key" :value="settings['STRIPE_KEY']" />
				<button class="button" @click="updateSetting('STRIPE_KEY')">Update</button>
			</div>
			<div>
				<label for="setting-stripe_secret_key">secret key</label>
				<input id="setting-stripe_secret_key" type="text" placeholder="secret key" :value="settings['STRIPE_SECRET_KEY']" />
				<button class="button" @click="updateSetting('STRIPE_SECRET_KEY')">Update</button>
			</div>
			<div>
				<label for="setting-stripe_membership_plan_id">plan id</label>
				<input id="setting-stripe_membership_plan_id" type="text" placeholder="plan id" :value="settings['STRIPE_MEMBERSHIP_PLAN_ID']" />
				<button class="button" @click="updateSetting('STRIPE_MEMBERSHIP_PLAN_ID')">Update</button>
			</div>
			<div>
				<label for="setting-stripe_webhook_id">webhook id</label>
				<input id="setting-stripe_webhook_id" type="text" placeholder="webhook id" :value="settings['STRIPE_WEBHOOK_ID']" />
				<button class="button" @click="updateSetting('STRIPE_WEBHOOK_ID')">Update</button>
			</div>

			<h2>Discord config</h2>
			<div>
				<label for="setting-discord_client_id">client id</label>
				<input id="setting-discord_client_id" type="text" placeholder="client id" :value="settings['DISCORD_CLIENT_ID']" />
				<button class="button" @click="updateSetting('DISCORD_CLIENT_ID')">Update</button>
			</div>
			<div>
				<label for="setting-discord_client_secret">client secret</label>
				<input id="setting-discord_client_secret" type="text" placeholder="client secret" :value="settings['DISCORD_CLIENT_SECRET']" />
				<button class="button" @click="updateSetting('DISCORD_CLIENT_SECRET')">Update</button>
			</div>
			<div>
				<label for="setting-discord_bot_token">bot token</label>
				<input id="setting-discord_bot_token" type="text" placeholder="bot token" :value="settings['DISCORD_BOT_TOKEN']" />
				<button class="button" @click="updateSetting('DISCORD_BOT_TOKEN')">Update</button>
			</div>
			<div>
				<label for="setting-discord_guild_id">guild id</label>
				<input id="setting-discord_guild_id" type="text" placeholder="guild id" :value="settings['DISCORD_GUILD_ID']" />
				<button class="button" @click="updateSetting('DISCORD_GUILD_ID')">Update</button>
			</div>

			<h2>Email config</h2>
			<div>
				<label for="setting-email_hostname">hostname</label>
				<input id="setting-email_hostname" type="text" placeholder="hostname" :value="settings['EMAIL_HOSTNAME']" />
				<button class="button" @click="updateSetting('EMAIL_HOSTNAME')">Update</button>
			</div>
			<div>
				<label for="setting-email_port">port</label>
				<input id="setting-email_port" type="text" placeholder="port" :value="settings['EMAIL_PORT']" />
				<button class="button" @click="updateSetting('EMAIL_PORT')">Update</button>
			</div>
			<div>
				<label for="setting-email_address">address</label>
				<input id="setting-email_address" type="text" placeholder="address" :value="settings['EMAIL_ADDRESS']" />
				<button class="button" @click="updateSetting('EMAIL_ADDRESS')">Update</button>
			</div>
			<div>
				<label for="setting-email_password">password</label>
				<input id="setting-email_password" type="text" placeholder="password" :value="settings['EMAIL_PASSWORD']" />
				<button class="button" @click="updateSetting('EMAIL_PASSWORD')">Update</button>
			</div>

			<h2>Logger config</h2>
			<div>
				<label for="setting-logger_max_size">max size (kb)</label>
				<input id="setting-logger_max_size" type="text" placeholder="max size (kb)" :value="settings['LOGGER_MAX_SIZE']" />
				<button class="button" @click="updateSetting('LOGGER_MAX_SIZE')">Update</button>
			</div>
			<div>
				<label for="setting-logger_new_lines">new lines</label>
				<input id="setting-logger_new_lines" type="text" placeholder="new lines" :value="settings['LOGGER_NEW_LINES']" />
				<button class="button" @click="updateSetting('LOGGER_NEW_LINES')">Update</button>
			</div>
		</div>
	</div>
</main>



<!--	JS LIBS	-->
<script src="vue.js"></script>
<script src="socket.io.js"></script>

<!--    MAIN JS    -->
<script type="text/javascript">
	const SOCKET = io();
	SOCKET.emit("get-member-list");
	SOCKET.emit("get-logs");
	SOCKET.emit("get-settings");
</script>
<script src="admin.js"></script>
</body>
</html>